#! /bin/bash

# File: "report-all-results"

# This shell script is run periodically by the periodic-task script.
# The first parameter is either "minor" or "major", indicating the
# type of periodic task (major is run every hour, and minor every minute).

KIND="$1"

echo "running report-all-results... KIND=$KIND"

source common-setup

rm -f "$FORENSICS_DIR/forensics.db"

$FORENSICS_DIR/compilers/venv/bin/python3 -m forensics.collector --conf "$FORENSICS_DIR/forensics.conf" --init

time $FORENSICS_DIR/compilers/venv/bin/python3 -m forensics.collector --conf "$FORENSICS_DIR/forensics.conf" --batch-all "$FORENSICS_DIR/system-builds"

ls -l "$FORENSICS_DIR/forensics.db"

$FORENSICS_DIR/compilers/venv/bin/python3 -m forensics.collector.export_json --conf "$FORENSICS_DIR/forensics.conf"

scp -P 443 forensics.json "feeley@gambitscheme.org:/usr/local/var/websites/forensics.gambitscheme.org/forensics.json"
