#! /bin/bash

# File: "report-all-results"

# This shell script is run periodically by the periodic-task script.
# The first parameter is either "minor" or "major", indicating the
# type of periodic task (major is run every hour, and minor every minute).

KIND="$1"

echo "running report-all-results... KIND=$KIND"

source common-setup

PYTHON3=$FORENSICS_DIR/compilers/venv/bin/python3

#---------------------------------------------------------

rm -f "$FORENSICS_DIR/python-forensics.db"

$PYTHON3 -m forensics.collector --conf "$FORENSICS_DIR/python-forensics.conf" --init

time $PYTHON3 -m forensics.collector --conf "$FORENSICS_DIR/python-forensics.conf" --batch "$FORENSICS_DIR/system-builds/zipi" "$FORENSICS_DIR/system-builds/cpython" "$FORENSICS_DIR/system-builds/pypy3" "$FORENSICS_DIR/system-builds/pypy2"

ls -l "$FORENSICS_DIR/python-forensics.db"

scp python-forensics.db "forensics@gambitscheme.org:/Users/forensics/forensics-databases/python/`hostname`.db"

#---------------------------------------------------------

rm -f "$FORENSICS_DIR/scheme-forensics.db"

$PYTHON3 -m forensics.collector --conf "$FORENSICS_DIR/scheme-forensics.conf" --init

time $PYTHON3 -m forensics.collector --conf "$FORENSICS_DIR/scheme-forensics.conf" --batch "$FORENSICS_DIR/system-builds/gambit"

ls -l "$FORENSICS_DIR/scheme-forensics.db"

$FORENSICS_DIR/compilers/venv/bin/python3 -m forensics.collector.export_json --conf "$FORENSICS_DIR/scheme-forensics.conf"

scp scheme-forensics.json "forensics@gambitscheme.org:/usr/local/var/websites/forensics.gambitscheme.org/forensics.json"

#---------------------------------------------------------
