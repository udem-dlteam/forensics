#! /bin/sh

# Usage:
#   ./bench zipi
#   ./bench python3.9
#   ./bench pypy3

SYSTEM="$1"

cd src

for b in *.py ; do

  NAME="`echo \"$b\" | sed -e 's/.py\$//'`"

  TOTAL="0"
  NRUNS="0"
  RESULT=""

  while true ; do

    EXEC_TIME="`$SYSTEM \"$NAME.py\" | grep \" seconds[ :]\" | sed -e \"s@ .*@@g\"`"

    if test "$EXEC_TIME" = "" ; then
      break
    fi

    RESULT="$RESULT$EXEC_TIME "

    TOTAL="`echo \"$TOTAL + $EXEC_TIME\" | bc`"
    NRUNS="`echo \"$NRUNS + 1\" | bc`"

    if test "`echo \"$TOTAL > 10\" | bc`" = "1" -o "$NRUNS" = "10" ; then
      break
    fi

  done

  if test "$NRUNS" = "0" ; then
    RESULT="CRASHED"
  fi

  echo '+!CSVLINE!+',"$NAME","$RESULT"

done
